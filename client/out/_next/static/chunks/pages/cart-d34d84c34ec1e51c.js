(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[190],{8086:function(r,n,e){(window.__NEXT_P=window.__NEXT_P||[]).push(["/cart",function(){return e(8997)}])},8675:function(r,n,e){"use strict";e.d(n,{G2:function(){return l},Ys:function(){return s},Yw:function(){return d},iq:function(){return m}});var t=e(2729),o=e(8806);function c(){let r=(0,t._)(["\n  mutation loginUser($name: String!, $phoneNumber: String!, $password: String!) {\n    loginUser(name: $name, phoneNumber: $phoneNumber, password: $password) {\n      token,\n      expirationTime\n    }\n}\n"]);return c=function(){return r},r}function i(){let r=(0,t._)(["\n  mutation AddToCart($productId: ID!, $phoneNumber: String!) {\n    addToCart(productId: $productId, phoneNumber: $phoneNumber)\n  }\n"]);return i=function(){return r},r}function a(){let r=(0,t._)(["\n  mutation DeleteFromCart($productId: ID!, $phoneNumber: String!) {\n    deleteFromCart(productId: $productId, phoneNumber: $phoneNumber)\n  }\n"]);return a=function(){return r},r}function u(){let r=(0,t._)(["\n  mutation PlaceOrder($phoneNumber: String!) {\n    placeOrder(phoneNumber: $phoneNumber) \n  }\n"]);return u=function(){return r},r}let s=(0,o.Ps)(c()),l=(0,o.Ps)(i()),d=(0,o.Ps)(a()),m=(0,o.Ps)(u())},8581:function(r,n,e){"use strict";e.d(n,{CP:function(){return h},bJ:function(){return d},ud:function(){return g},wq:function(){return m}});var t=e(2729),o=e(8806);function c(){let r=(0,t._)(["\n  query FetchCartItems {\n    fetchCartItems {\n      id\n      name\n      price\n      description\n      image\n      avgRating\n      category\n    }\n  }\n"]);return c=function(){return r},r}function i(){let r=(0,t._)(["\n  query FetchProducts(\n    $search: String\n    $category: String\n    $rating: String\n    $sortBy: String\n  ) {\n    fetchProducts(\n      search: $search\n      category: $category\n      rating: $rating\n      sortBy: $sortBy\n    ) {\n      id\n      name\n      price\n      description\n      image\n      avgRating\n      category\n    }\n  }\n"]);return i=function(){return r},r}function a(){let r=(0,t._)(["\n  query ProductIds {\n    productIds\n  }\n"]);return a=function(){return r},r}function u(){let r=(0,t._)(["\n  query Product($id: ID!) {\n    product(id: $id) {\n      id\n      name\n      price\n      description\n      image\n      avgRating\n      category\n    }\n  }\n"]);return u=function(){return r},r}function s(){let r=(0,t._)(["\n  query FetchUserCart($phoneNumber: String!) {\n    userCartItems(phoneNumber: $phoneNumber)\n  }\n"]);return s=function(){return r},r}function l(){let r=(0,t._)(["\n  query FetchUserOrder($phoneNumber: String!) {\n    userOrders(phoneNumber: $phoneNumber)\n  }\n"]);return l=function(){return r},r}(0,o.Ps)(c());let d=(0,o.Ps)(i());(0,o.Ps)(a());let m=(0,o.Ps)(u()),h=(0,o.Ps)(s()),g=(0,o.Ps)(l())},8997:function(r,n,e){"use strict";e.r(n),e.d(n,{default:function(){return b}});var t=e(5893),o=e(7294);e(5675);var c=e(319),i=e(8675),a=e(6748);function u(r){let{theme:n}=(0,a.F)(),[e,u]=(0,o.useState)(null),[s]=(0,c.D)(i.Yw);(0,o.useEffect)(()=>{let r=localStorage.getItem("phoneNumber");r&&u(r)},[]);let l=async()=>{try{let n=r.id;console.log(n),console.log(e);let{data:t}=await s({variables:{productId:n,phoneNumber:e}});r.setCartProducts(r.cartProducts.filter(n=>n.id!==r.id)),console.log("Product removed from cart:",t)}catch(r){console.error("Error removing product from cart:",r)}};return(0,t.jsx)("div",{className:"card mb-3",style:{backgroundColor:"dark"===n?"#101010":"white",color:"dark"===n?"white":"#101010",borderColor:"dark"===n?"white":""},children:(0,t.jsxs)("div",{className:"row g-0",children:[(0,t.jsx)("div",{className:"col-md-4",children:(0,t.jsx)("img",{src:r.image,alt:r.name,className:"img-fluid rounded-start",style:{width:"200px",height:"150px"},loading:"lazy"})}),(0,t.jsx)("div",{className:"col-md-8",children:(0,t.jsxs)("div",{className:"card-body",children:[(0,t.jsx)("h5",{className:"card-name",children:r.name}),(0,t.jsxs)("p",{className:"card-text",children:["Price: $",r.price]}),(0,t.jsx)("button",{onClick:l,className:"btn btn-danger",children:"Delete"})]})})]})})}var s=e(1163),l=e(1664),d=e.n(l),m=e(1494),h=e(6812),g=e(8581),p=e(1507),f=e.n(p),b=function(){let[r,n]=(0,o.useState)(!1),[e,l]=(0,o.useState)([]),[p,b]=(0,o.useState)([]),[v,N]=(0,o.useState)(null),x=(0,s.useRouter)(),{theme:y}=(0,a.F)(),[$]=(0,c.D)(i.iq),{data:j,loading:w}=(0,h.a)(g.CP,{variables:{phoneNumber:v}});(0,o.useEffect)(()=>{!w&&j&&l(j.userCartItems)},[j,w]),(0,o.useEffect)(()=>{let r=localStorage.getItem("token"),t=localStorage.getItem("expirationTime");N(localStorage.getItem("phoneNumber")),(async()=>{try{if(e.length>0){let r=e.map(r=>C(r)),n=(await Promise.all(r)).map(r=>r.product);console.log(n),b(n)}}catch(r){console.error("Error fetching cart products:",r)}})(),r&&t?t<Date.now()?n(!1):n(!0):n(!1)},[e]);let C=async r=>{try{let{data:n}=await m.Z.query({query:g.wq,variables:{id:r}});return n}catch(r){return console.error("Error fetching product:",r),null}},P=async()=>{try{let r=localStorage.getItem("phoneNumber");await $({variables:{phoneNumber:r}}),l([])}catch(r){console.error("Error placing order:",r)}};return r?(0,t.jsxs)("div",{className:"".concat(f().container),style:{backgroundColor:"light"===y?"white":"#131313",color:"light"===y?"black":"white"},children:[(0,t.jsx)("br",{}),(0,t.jsx)("h1",{className:"mb-4",children:"Cart \uD83D\uDED2"}),(0,t.jsxs)("div",{className:"row",children:[(0,t.jsx)("div",{className:"col-md-8",children:p.length>0?p.map((r,n)=>(0,t.jsx)(u,{name:r.name,price:r.price,image:r.image,id:r.id,cartProducts:p,setCartProducts:b},n)):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("br",{}),(0,t.jsx)("h5",{children:"Cart is empty!"}),(0,t.jsx)("h6",{children:"Add some items to the cart to see them here."})]})}),(0,t.jsxs)("div",{className:"col-md-4",children:[(0,t.jsx)("div",{className:"card mb-4",style:{backgroundColor:"white"},children:(0,t.jsxs)("div",{className:"card-body",children:[(0,t.jsx)("h5",{className:"card-title",children:"Total:"}),(0,t.jsxs)("p",{className:"card-text",children:["$ ",p.reduce((r,n)=>r+n.price,0)]})]})}),(0,t.jsx)(d(),{href:"/",className:"btn btn-secondary me-2",children:"Back"}),(0,t.jsx)("button",{onClick:()=>{P(),alert("Your order has been placed!"),x.push("/orders")},className:"btn btn-primary",children:"Place Order"})]})]})]}):(0,t.jsxs)("div",{className:"".concat(f().container),style:{backgroundColor:"light"===y?"white":"#131313",color:"light"===y?"black":"white"},children:[(0,t.jsx)("br",{}),(0,t.jsx)("h5",{children:"Login to see your cart!"})]})}},1507:function(r){r.exports={container:"Cart_container__rWtGT"}},319:function(r,n,e){"use strict";e.d(n,{D:function(){return l}});var t=e(7582),o=e(3914),c=e(4012),i=e(20),a=e(4692),u=e(990),s=e(6252);function l(r,n){var e=(0,s.x)(null==n?void 0:n.client);(0,a.Vp)(r,a.n_.Mutation);var l=o.useState({called:!1,loading:!1,client:e}),d=l[0],m=l[1],h=o.useRef({result:d,mutationId:0,isMounted:!0,client:e,mutation:r,options:n});Object.assign(h.current,{client:e,options:n,mutation:r});var g=o.useCallback(function(r){void 0===r&&(r={});var n=h.current,e=n.options,o=n.mutation,a=(0,t.pi)((0,t.pi)({},e),{mutation:o}),s=r.client||h.current.client;h.current.result.loading||a.ignoreResults||!h.current.isMounted||m(h.current.result={loading:!0,error:void 0,data:void 0,called:!0,client:s});var l=++h.current.mutationId,d=(0,c.J)(a,r);return s.mutate(d).then(function(n){var e,t,o=n.data,c=n.errors,a=c&&c.length>0?new u.cA({graphQLErrors:c}):void 0,g=r.onError||(null===(e=h.current.options)||void 0===e?void 0:e.onError);if(a&&g&&g(a,d),l===h.current.mutationId&&!d.ignoreResults){var p={called:!0,loading:!1,data:o,error:a,client:s};h.current.isMounted&&!(0,i.D)(h.current.result,p)&&m(h.current.result=p)}var f=r.onCompleted||(null===(t=h.current.options)||void 0===t?void 0:t.onCompleted);return a||null==f||f(n.data,d),n}).catch(function(n){if(l===h.current.mutationId&&h.current.isMounted){var e,t={loading:!1,error:n,data:void 0,called:!0,client:s};(0,i.D)(h.current.result,t)||m(h.current.result=t)}var o=r.onError||(null===(e=h.current.options)||void 0===e?void 0:e.onError);if(o)return o(n,d),{data:void 0,errors:n};throw n})},[]),p=o.useCallback(function(){if(h.current.isMounted){var r={called:!1,loading:!1,client:e};Object.assign(h.current,{mutationId:0,result:r}),m(r)}},[]);return o.useEffect(function(){return h.current.isMounted=!0,function(){h.current.isMounted=!1}},[]),[g,(0,t.pi)({reset:p},d)]}}},function(r){r.O(0,[51,675,812,888,774,179],function(){return r(r.s=8086)}),_N_E=r.O()}]);